<template name="bookEdit">
  <nav>
    <div class="nav-wrapper grey lighten-3" style="padding-left: 10px">
      <div class="col s12">
        <a href="{{pathFor '/books'}}" class="breadcrumb grey-text text-darken-3">Books</a>
        <span class="breadcrumb grey-text text-darken-3">{{getBook.name}}</span>
      </div>
    </div>
  </nav>
  {{#if isSubReady 'book'}}
    {{#with getBook}}
    <div style="position: absolute; top: 78px; right: 10%;">
      <span class="grey-text text-darken-3">Current view:</span> <a href="#" id="book_view" class="dropdown-button btn-flat waves-effect waves-light green-text"  data-activates="view_type"><i class="material-icons right">arrow_drop_down</i>RULES</a>
      <ul id="view_type" class="dropdown-content">
        <li><a id="btn_book_details" href="#" class="green-text">BOOK DETAILS</a></li>
        <li><a id="btn_book_elements" href="#" class="green-text">ELEMENTS</a></li>
        <li><a id="btn_book_rules" href="#" class="green-text">RULES</a></li>
      </ul>
    </div>
    <div class="row book-view" id="book_elements" style="display: none;">
      <div class="col s12">
        {{> bookElements}}
      </div>
    </div>
    <div class="book-view" id="book_details" style="display: none;">
      {{#if isInRole 'admin' 'default_group'}}
      <div style="position: absolute; top: 78px; right: 2%;">
        <a href="#" id="save_book" style="margin-left: 20px;" class="btn waves-effect waves-light light-green tooltipped" data-position="bottom" data-delay="50" data-tooltip="Save book">Save</a>
      </div>
      {{/if}}
      <div class="row">
        <div class="col s12">
          <div class="row" style="margin-top: 20px;">
            <div class="input-field col s5">
              <input type="hidden" id="edit_book_id" name="edit_book_id" value="{{_id}}"/>
              <input type="text" placeholder="Enter the name of the book" id="edit_book_name" name="edit_book_name" class="validate" value="{{name}}"/>
              <label for="edit_book_name" class="active" >Name of Book</label>
            </div>
          </div>
          <div class="row">
            <div class="col s12">
              {{> elementGroups}}
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="book-view" id="book_rules">
      <div class="row" style="margin-top: 20px;">
        <div class="col s12">
          {{> bookRules}}
        </div>
      </div>
    </div>
    {{/with}}
  {{else}}
    {{> loading}}
  {{/if}}
</template>

<template name="bookElements">
  <div class="row">
    <div class="col s2">
      <div class="grey-text" style="margin-top: 20px;">Question Elements</div>
      <div class="sortable">
      {{#sortable items=bookElementTypes options=bookElementTypesOptions}}
        <div class="element"><i class="material-icons">{{icon type}}</i>{{name}}</div>
      {{/sortable}}
      </div>
      <div class="grey-text" style="margin-top: 20px;">Other Elements</div>
      <div class="sortable">
      {{#sortable items=bookOtherTypes options=bookElementTypesOptions}}
        <div class="element"><i class="material-icons">{{icon type}}</i>{{name}}</div>
      {{/sortable}}
      </div>
    </div>
    <div class="col s10">
      {{#each elementGroups}}
      <div class="bookelement-group grey-text" style="margin-top: 20px;"><i class="material-icons">{{icon type}}</i>{{text}}</div>
      <div class="sortable" group_id="{{_id}}">
      {{#sortable items=bookElements options=bookElementsOptions}}
        <div class="element {{type}}" >
          <div class="bookelement" id={{_id}}><i class="material-icons grey-text handle book-element-item">drag_handle</i><i class="material-icons book-element-item">{{icon type}}</i><span class="truncate book-element-item">{{text}}</span></div>
          <div id="details_{{_id}}" class="bookelementdetails inactive grey lighten-2">{{> bookElementDetails}}</div>
        </div>
      {{/sortable}}
      </div>
      {{/each}}
    </div>
  </div>
</template>

<template name="bookRules">
  <div class="row">
    <div class="col s2">
      {{#if isRules}}

      {{else}}
        <div style="border: 1px dashed #dcdcdc; padding: 4px; width: 100%;" class="grey-text">There are no rules currently setup</div>
      {{/if}}
      <a class="btn waves-effect light-green" style="margin-top: 10px;">Add Rule</a>
    </div>
    <div class="col s10">
      {{#each elementGroups}}
      <div class="grey-text rule-group" style="margin-top: 20px;"><i class="material-icons rule-group-item">{{icon type}}</i>{{text}}</div>
      <div group_id="{{_id}}">
        {{#each bookElements}}
        <div class="{{type}}" >
          <div class="rule" id={{_id}}>
            <i class="material-icons rule-item">{{icon type}}</i><span class="truncate rule-item">{{text}}</span>
            <div class="truncate rule-item" style="width: calc(25% - 64px); text-align: right;">
              <a class="btn-floating waves-effect blue"><i class="material-icons">code</i>Condition</a>
              <a class="btn-floating waves-effect light-green"><i class="material-icons">gps_fixed</i>Target</a>
            </div>
          </div>
        </div>
        {{/each}}
      </div>
      {{/each}}
    </div>
  </div>
</template>

<template name="elementGroups">
  <div class="row">
    <div class="col s2">
      <div class="grey-text" style="margin-top: 20px;">Section Types</div>
      <div class="sortable">
      {{#sortable items=elementGroupTypes options=elementGroupTypesOptions}}
        <div class="element-group"><i class="material-icons">{{icon type}}</i>{{name}}</div>
      {{/sortable}}
      </div>
    </div>
    <div class="col s10">
      <div class="grey-text" style="margin-top: 20px;">Book Sections</div>
      <div class="sortable">
      {{#sortable items=elementGroups options=elementGroupOptions}}
        <div class="element-group {{type}}" >
          <div class="bookelement-group" id={{_id}}><i class="material-icons grey-text handle book-element-group-item">drag_handle</i><i class="material-icons book-element-group-item">{{icon type}}</i><span class="truncate book-element-group-item">{{text}}</span></div>
          <div id="details_{{_id}}" class="elementgroupdetails inactive grey lighten-2">{{> elementGroupDetails}}</div>
        </div>
      {{/sortable}}
      </div>
    </div>
  </div>
</template>
