<template name="bookEdit">
  <nav>
    <div class="nav-wrapper grey lighten-3" style="padding-left: 10px">
      <div class="col s12">
        <a href="{{pathFor '/books'}}" class="breadcrumb grey-text text-darken-3">Books</a>
        <span class="breadcrumb grey-text text-darken-3">{{getBook.name}}</span>
      </div>
    </div>
  </nav>
  {{#if isSubReady 'book'}}
    {{#with getBook}}
    <div style="position: absolute; top: 78px; right: 10%;">
      <span class="grey-text text-darken-3">Current view:</span> <a href="#" id="book_view" class="dropdown-button btn-flat waves-effect waves-light green-text"  data-activates="view_type"><i class="material-icons right">arrow_drop_down</i>RULES</a>
      <ul id="view_type" class="dropdown-content">
        <li><a id="btn_book_details" href="#" class="green-text">BOOK DETAILS</a></li>
        <li><a id="btn_book_elements" href="#" class="green-text">ELEMENTS</a></li>
        <li><a id="btn_book_rules" href="#" class="green-text">RULES</a></li>
      </ul>
    </div>
    <div class="row book-view" id="book_elements" style="display: none;">
      <div class="col s12">
        {{> bookElements}}
      </div>
    </div>
    <div class="book-view" id="book_details" style="display: none;">
      {{#if isInRole 'admin' 'default_group'}}
      <div style="position: absolute; top: 78px; right: 2%;">
        <a href="#" id="save_book" style="margin-left: 20px;" class="btn waves-effect waves-light light-green tooltipped" data-position="bottom" data-delay="50" data-tooltip="Save book">Save</a>
      </div>
      {{/if}}
      <div class="row">
        <div class="col s12">
          <div class="row" style="margin-top: 20px;">
            <div class="input-field col s5">
              <input type="hidden" id="edit_book_id" name="edit_book_id" value="{{_id}}"/>
              <input type="text" placeholder="Enter the name of the book" id="edit_book_name" name="edit_book_name" class="validate" value="{{name}}"/>
              <label for="edit_book_name" class="active" >Name of Book</label>
            </div>
          </div>
          <div class="row">
            <div class="col s12">
              {{> elementGroups}}
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="book-view" id="book_rules">
      <div class="row" style="margin-top: 20px;">
        <div class="col s12">
          {{> bookRules}}
        </div>
      </div>
    </div>
    {{/with}}
  {{else}}
    {{> loading}}
  {{/if}}
</template>

<template name="bookElements">
  <div class="row">
    <div class="col s2">
      <div class="grey-text" style="margin-top: 20px;">Question Elements</div>
      <div class="sortable">
      {{#sortable items=bookElementTypes options=bookElementTypesOptions}}
        <div class="element"><i class="material-icons">{{icon type}}</i>{{name}}</div>
      {{/sortable}}
      </div>
      <div class="grey-text" style="margin-top: 20px;">Other Elements</div>
      <div class="sortable">
      {{#sortable items=bookOtherTypes options=bookElementTypesOptions}}
        <div class="element"><i class="material-icons">{{icon type}}</i>{{name}}</div>
      {{/sortable}}
      </div>
    </div>
    <div class="col s10">
      {{#each elementGroups}}
      <div class="bookelement-group grey-text" style="margin-top: 20px;"><i class="material-icons">{{icon type}}</i>{{text}}</div>
      <div class="sortable" group_id="{{_id}}">
      {{#sortable items=bookElements options=bookElementsOptions}}
        <div class="element {{type}}" >
          <div class="bookelement" id={{_id}}><i class="material-icons grey-text handle book-element-item">drag_handle</i><i class="material-icons book-element-item">{{icon type}}</i><span class="truncate book-element-item">{{text}}</span></div>
          <div id="details_{{_id}}" class="bookelementdetails inactive grey lighten-2">{{> bookElementDetails}}</div>
        </div>
      {{/sortable}}
      </div>
      {{/each}}
    </div>
  </div>
</template>

<template name="bookRules">
  <div class="row">
    <div class="col s2">
      {{#if isRules}}
        {{#each rules}}
        <div class="rule-group row" rule-id="{{_id}}">
          <div class="col s12 light-green {{ruleBackground _id}} white-text">Condition: {{#if ruleHasConditions}}Set{{else}}Not set{{/if}}</div>
          <div class="col s12 blue {{ruleBackground _id}} white-text">Target: {{#if ruleHasTargets}}Set{{else}}Not set{{/if}}</div>
        </div>
        {{/each}}
      {{else}}
        <div style="border: 1px dashed #dcdcdc; padding: 4px; width: 100%;" class="grey-text">There are no rules currently setup</div>
      {{/if}}
      <a class="btn waves-effect light-green" style="margin-top: 10px;" id="btn_bookrule_add">Add Rule</a>
    </div>
    <div class="col s10">
      {{#if ruleSelected}}
        <div class="col s12" style="position: relative; height: 50px;">
          <div style="position: absolute; top: 0px; left: 0px;">You have selected a rule, now select the condition and target questions</div>
          <div class="fixed-action-btn horizontal click-to-toggle" style="position: absolute; top: 0px; right: 0px;">
            <a class='btn-floating white'><i class="material-icons" style="color: #8bc34a !important;">more_horiz</i></a>
            <ul style="position: absolute; top: 0px;">
              <li><a href="#" class="bookrule_delete btn-floating red"><i class="material-icons">delete</i></a></li>
            </ul>
          </div>
        </div>
        {{#each elementGroups}}
        <div class="grey-text rule-group" style="margin-top: 20px;">
          <i class="material-icons rule-group-item">{{icon type}}</i><span class="truncate rule-group-item">{{text}}</span>
          <div class="truncate rule-group-item" style="width: calc(25% - 41px); text-align: right;">
            {{#if showGroupTarget _id}}
            <a class="btn-floating waves-effect blue turn-on-bookrulegroup-target" group-id="{{_id}}"><i class="material-icons">gps_fixed</i></a>
            {{/if}}
          </div>
        </div>
        <div group_id="{{_id}}">
          {{#each bookElements}}
          <div class="{{type}}" >
            <div class="rule" id={{_id}}>
              <i class="material-icons rule-item">{{icon type}}</i><span class="truncate rule-item">{{text}}</span>
              <div class="truncate rule-item" style="width: calc(25% - 64px); text-align: right;">
                {{#if showCondition _id}}
                <a class="btn-floating waves-effect light-green turn-on-bookrule-condition" element-id={{_id}} element-type="{{type}}"><i class="material-icons">code</i></a>
                {{/if}}
                {{#if showTarget _id}}
                <a class="btn-floating waves-effect blue turn-on-bookrule-target" element-id="{{_id}}"><i class="material-icons">gps_fixed</i></a>
                {{/if}}
              </div>
            </div>
          </div>
          {{/each}}
        </div>
        {{/each}}
      {{else}}
        Currently, there is no rule selected. Click on of the rules to the left, or click 'Add Rule'.
      {{/if}}
    </div>
  </div>
</template>

<template name="elementGroups">
  <div class="row">
    <div class="col s2">
      <div class="grey-text" style="margin-top: 20px;">Section Types</div>
      <div class="sortable">
      {{#sortable items=elementGroupTypes options=elementGroupTypesOptions}}
        <div class="element-group"><i class="material-icons">{{icon type}}</i>{{name}}</div>
      {{/sortable}}
      </div>
    </div>
    <div class="col s10">
      <div class="grey-text" style="margin-top: 20px;">Book Sections</div>
      <div class="sortable">
      {{#sortable items=elementGroups options=elementGroupOptions}}
        <div class="element-group {{type}}" >
          <div class="bookelement-group" id={{_id}}><i class="material-icons grey-text handle book-element-group-item">drag_handle</i><i class="material-icons book-element-group-item">{{icon type}}</i><span class="truncate book-element-group-item">{{text}}</span></div>
          <div id="details_{{_id}}" class="elementgroupdetails inactive grey lighten-2">{{> elementGroupDetails}}</div>
        </div>
      {{/sortable}}
      </div>
    </div>
  </div>
</template>
